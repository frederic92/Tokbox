// Replace with your OpenTok API key and session ID:

console.log("Got the token to the client: <%= @token %>, as well as the session_id: <%= @session_id %>, and the api_key: <%= @api_key %>");
//var api_key = <%= @api_key %>;
//var session_id = <%= @session_id %>;
var session = OT.initSession("<%= @api_key %>", "<%= @session_id %>");
console.log(session);

var publisherProperties = {insertMode: "append"};
var publisher = OT.initPublisher('publisher', publisherProperties, function (error) {
  if (error) {
    console.log(error);
  } else {
    console.log("Publisher initialized.");
  }
});
session.connect("<%= @token %>", function(error) {
  if (error) {
    console.log("Error connecting: MBEA", error.name, error.message);
  } else {
    console.log("Connected to the session.");
    session.publish(publisher, function(error) {
      if (error) {
        console.log(error);
      } else {
        console.log("Publishing a stream");
      }
    })
  }
});
